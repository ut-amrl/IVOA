# ML Tool Evaluation


## Dependencies
We provide a script, `./install_dependencies.sh`, which should install the necessary dependencies on an ubuntu-based system.

Below is a list of the dependencies of this tool, but after using the above script, none should need to be installed manually:
[OpenCV](https://opencv.org/)
[Eigen](http://eigen.tuxfamily.org/index.php?title=Main_Page)
[cnpy](https://github.com/rogersce/cnpy)
[pcl](https://pointclouds.org/)
[ROS](https://www.ros.org/)
[JsonCpp](https://github.com/open-source-parsers/jsoncpp)
[YAMLcpp](https://github.com/jbeder/yaml-cpp)
[Boost](https://www.boost.org/)


## Build
```bash
source set_env.bash
mkdir build && cd build
cmake .. && make
```


## Run

```bash
cd scripts
./run_mltool_evaluation.bash
```

This script takes the following arguments, in sequential order:
```
SOURCE_DIR - the directory containing the input data to evaluate.
OUT_DIR - the directory into which to place the results of evaluation
SESSION_NUM - a numerical label to put on the subfolder containing the results of this evaluation
TRAJECTORY_PATH - the file containing the trajectory information corresponding to the input data.
```

An example command:
```bash
./run_mltool_evaluation.bash /data/CAML/CRA_ML_tool/0015_20200325_420sec_daytime_wxclear/ /data/CAML/CRA_ML_tool/evaluation 15 /data/CAML/CRA_ML_tool/trajectories/state_20200325_420sec.txt 
```

Running this script (`scripts/run_mltool_evaluation.bash`) will evaluate the ML tool on the given input data and trajectory, and place results in a subfolder in the output directory. This folder contains data necessary for generating histograms, as well as a summary of statistics in a file named `prediction_label_statistics.txt`. Note that by default, these statistics are generate assuming that any error <= 1m is considered a correct depth estimate.

The script will, by default, evaluate with a maximum range horizon of 10m, and ignore any errors for objects farther away than that. This can be changed by modifying the line:
`MAX_RANGES=( 10 )` in the script. It supports evaluating over multiple ranges, each of which will be put in its own output subdirectory.
After running the script, the output will be generated in `[OUT_DIR]/session_[SESSION_NUM]_range_[MAX_RANGE]` for each range specified in `MAX_RANGES`.

In addition, the script specifies camera calibration files (Instrinsics+Extrinsics) for both the Ground Truth, and ML-Tool images. These can also be modified by manually editing the script.

## Visualize
Once results have been generated, generating histograms can be done by running:

```bash
cd scripts
python visualize_histograms.py --dir DIR
```
Here, DIR is the output *subdirectory* as generated by the evaluation.

An example command:
```bash
python visualize_histograms.py --dir /data/CAML/CRA_ML_tool/evaluation/session_0015_range_10/
```

Running this will output the histogram visualizations as `.png` files in the given directory.